name       : nextcloud-client
version    : 2.5.1
release    : 10
source     :
    - https://github.com/nextcloud/desktop/archive/v2.5.1.tar.gz : 48be2556f4fddb956ad31e954be5f9c73482e936a80ec0efaeb30549dcd81f19
license    : GPL-2.0-or-later
component  :
    - network.download
    - dolphin-integration : network.download
libsplit   : no
summary    : Nextcloud desktop client
description:
    - Nextcloud client enables you to connect to your private Nextcloud Server. With it you can create directories in your home directory, and keep the contents of those directories synced with the server. Simply copy a file into the directory and the desktop synchronisation client does the rest.
    - dolphin-integration : Dolphin file manager integration for the Nextcloud client.
builddeps  :
    - pkgconfig(Qt5UiTools)
    - pkgconfig(Qt5WebEngine)
    - pkgconfig(Qt5WebKit)
    - pkgconfig(sqlite3)
    - extra-cmake-modules
    - kio-devel
    - libiconv-devel
    - qtkeychain-devel
    - xdg-utils
rundeps    :
    - libgnome-keyring
    - qt5-svg
    - qt5-webengine
    - qt5-webkit
    - dolphin-integration :
        - nextcloud-client
patterns   :
    - dolphin-integration :
        - /usr/lib64/libnextclouddolphinpluginhelper.so
        - /usr/lib64/qt5/*
        - /usr/share/kservices5/*
setup      : |
    # No, you don't require 1.1 Nextcloud, don't lie to me.
    sed -i 's:OpenSSL 1.1:OpenSSL 1.0:g' CMakeLists.txt
    %patch -p1 < $pkgfiles/fix-build-with-qt5.12.patch
    %patch -p1 < $pkgfiles/fix-login-crash.patch
    %cmake_ninja -DUNIT_TESTING=true -DBUILD_SHELL_INTEGRATION_DOLPHIN=true
build      : |
    %ninja_build
install    : |
    %ninja_install

    # Remove nemo extensions
    rm -rf $installdir/usr/share/nemo-python
check      : |
    %ninja_check
